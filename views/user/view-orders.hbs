
<h2 class=" text-center mt-5 mb-3 font-weight-bold" style="color: #eb4b07;">ORDER HISTORY</h2>

<section class="">
<div class="container">
<table class="table align-middle mb-0 bg-white" id="myTable">
  <thead class="bg-light">
    {{!-- <tr>
      <th>SNo.</th>
      <th>Date</th>
      <th>Name</th>
      <th>Address</th>
      <th>Total Amount</th>
      <th>Payment Mode</th>
      <th scope="col" style="color: green;">Order Status</th>
      
    </tr> --}}
  </thead>
  <tbody>
     
     {{#each orders}}
   <tr>
      <td>
        <p class="create_index"></p>
      </td>
      <td>
         <img src="/product-imgs/{{this.image.[0]}}" alt="" class="mb-2" style="height: 100px ;width:100px"><br>
         <p class="mb-1 font-weight-bold" style="font-size:15px;color:blueviolet">{{this.name}}</p>
         
      </td>          
      <td>
        <p class="mb-0" style="font-size:15px;">Purchase Date :<span class="font-weight-bold text-success">{{this.date}}</span></p><br>
        <p class="mb-0" style="font-size:15px;">Invoice No :<span class="font-weight-bold text-success">{{this.invoice}}</span></p>
         <p class="fw-normal mb-0">Payment Mode : <span class="font-weight-bold" style="color:#eb4b07">{{this.paymentMathod}}</span></p>
         <p class="fw-normal mb-1">Quantity : <span class="font-weight-bold" style="color:black">{{this.quantity}}</span></p>
         
      </td>

      <td>
        <p class="fw-normal mt-5 mb-0">MRP: ₹<span class="text-primary font-weight-bold"><del>{{this.subMRP}}</del></span></p>
        <p class="fw-normal mb-1">Frello Price: ₹<span class="text-primary font-weight-bold">{{this.subtotal}}</span></p>
      </td>

      
       

      
      
      <td>
        <h5 class="mb-3 text-success font-weight-bold">{{this.status}}</h5>
        <a href="/view-order-products?id={{this._id}}" class="btn btn-primary">View</a>
        {{#if this.statbar}}

      {{else}}
        
        {{#if this.statusbar}}
      
       <a onclick="changeStat('{{this._id}}','{{this.item}}')" class="btn btn-danger">Cancel</a>

      {{else}}
      
        <a onclick="returnStat('{{this._id}}','{{this.item}}')" class="btn btn-warning">Return</a>
      
      {{/if}}
      {{/if}}
    
  <p>
             <a class="btn btn-dark mt-3" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
    Track Order
  </a>
</p>




<div class="collapse col-md-12" id="collapseExample">
  <div class="card card-body mt-4 col-md-12">

{{!-- <================================stepper=====================================> --}}

    {{#isEqual this.status 'Despatched'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span class="dot"></span>
              <hr class="flex-fill track-line"><span
                class="d-flex justify-content-center align-items-center big-dot dot">
                <i class="fa fa-check text-white"></i></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>

              <hr class="flex-fill track-line"><span class="dot"></span>

            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Placed</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span>Despatched</span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Shipped</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span>Out for
                  delivery</span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Delivered</span></div>
              
            </div>
           {{/isEqual}}

            {{#isEqual this.status 'Shipped'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center" >
              <span class="dot"></span>
              <hr class="flex-fill track-line" ><span class="dot"></span>
              <hr class="flex-fill track-line"><span
                class="d-flex justify-content-center align-items-center big-dot dot">
                <i class="fa fa-check text-white"></i></span>
              <hr class="flex-fill track-line"><span class="dot"></span>

              <hr class="flex-fill track-line"><span class="dot"></span>

            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Placed</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span>Despatched</span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Shipped</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span>Out for
                  delivery</span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Delivered</span></div>
              
            </div>
            {{/isEqual}}
            

            {{#isEqual this.status 'Out for Delivery'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
              <hr class="flex-fill track-line"><span
                class="d-flex justify-content-center align-items-center big-dot dot">
                <i class="fa fa-check text-white"></i></span>

              <hr class="flex-fill track-line"><span class="dot"></span>

            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Placed</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span>Despatched</span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Shipped</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span>Out for
                  delivery</span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Delivered</span></div>
              
            </div>
            {{/isEqual}}
            

            {{#isEqual this.status 'Delivered'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
              
              <hr class="flex-fill track-line"><span
                class="d-flex justify-content-center align-items-center big-dot dot">
                <i class="fa fa-check text-white"></i></span>
            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Placed</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span>Despatched</span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Shipped</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span>Out for
                  delivery</span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Delivered</span></div>
              
            </div>
            {{/isEqual}}

          

            {{#isEqual this.status 'Cancelled'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span class="dot bg-danger"></span>
              <hr class="flex-fill track-line bg-danger">
              <hr class="flex-fill track-line bg-danger">
              <hr class="flex-fill track-line bg-danger">
              
              <hr class="flex-fill track-line bg-danger"><span
                class="d-flex justify-content-center align-items-center big-dot dot bg-danger">
                <i class="fa fa-check text-white"></i></span>
            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span></span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span></span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span></span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span></span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Cancelled</span></div>
              
            </div>
            {{/isEqual}}

            

             {{#isEqual this.status 'Return Requested'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span class="dot "></span>
              <hr class="flex-fill track-line">
              <hr class="flex-fill track-line "><span
                class="d-flex justify-content-center align-items-center big-dot dot bg-warning">
                <i class="fa fa-check text-white"></i></span>
              <hr class="flex-fill track-line bg-warning">
              
              <hr class="flex-fill track-line bg-warning"><span class="dot"></span>
            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Delivered</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span></span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Return Requested</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span></span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span></span></div>
              
            </div>
            {{/isEqual}}

           

            {{#isEqual this.status 'Return Completed'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span
                class="d-flex justify-content-center align-items-center big-dot dot bg-warning">
                <i class="fa fa-check text-white"></i></span>
              <hr class="flex-fill track-line bg-warning">
              <hr class="flex-fill track-line bg-warning"><span class="dot bg-warning"></span>
              <hr class="flex-fill track-line bg-warning">
              
              <hr class="flex-fill track-line bg-warning"><span class="dot bg-success"></span>
            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Return Completed</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span></span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Return Requested</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span></span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Delivered</span></div>
              
            </div>
            {{/isEqual}}

            {{#isEqual this.status 'Placed'}}
            <div class="d-flex flex-row justify-content-between align-items-center align-content-center">
              <span
                class="d-flex justify-content-center align-items-center big-dot dot"><i class="fa fa-check text-white"></i></span>
              <hr class="flex-fill track-line"><span class="dot"></span>
                
              <hr class="flex-fill track-line"><span class="dot"></span>
              <hr class="flex-fill track-line"><span class="dot"></span>

              <hr class="flex-fill track-line"><span class="dot"></span>

            </div>

             <div class="d-flex flex-row justify-content-between align-items-center">
              <div class="d-flex flex-column align-items-start"><span></span><span>Placed</span>
              </div>
              <div class="d-flex flex-column justify-content-center"><span></span><span>Despatched</span></div>
              <div class="d-flex flex-column justify-content-center align-items-center"><span>
             </span><span>Shipped</span></div>
              <div class="d-flex flex-column align-items-center"><span></span><span>Out for
                  delivery</span></div>
              <div class="d-flex flex-column align-items-end"><span></span><span>Delivered</span></div>
              
            </div>

            {{/isEqual}}
  
  {{!-- <=======================stepper=====================> --}}
  </div>
</div>

</td>


    </tr>
    
{{!-- <=====================accordion==========================> --}}



    {{/each}}
    
  </tbody>
</table>


</div>

{{!-- <==============pagenation==============> --}}
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li class="page-item ">
      <a class="page-link" href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
        <span class="sr-only">Previous</span>
      </a>
    </li>
    {{#each count}}
    <li class="page-item"><a class="page-link" href="/orders?id={{ this }}">{{this}}</a></li>
    {{/each}}
    
    <li class="page-item">
      <a class="page-link" href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
        <span class="sr-only">Next</span>
      </a>
    </li>
  </ul>
</nav>

{{!-- <==============pagenation==========> --}}
</section>

    <script>
   var divs = document.querySelectorAll('.create_index'); for (var i = 0; i <
    divs.length; ++i) { divs[i].innerHTML = i + 1; }
  </script>            

<script>
  function changeStat(oId,pId){

    $.ajax({

      url:'/cancel-order',
      data:{
        oId:oId,
        pId:pId
      },
      method:'post',
      success:(response)=>{
         location.reload()
      }

    })

  }
  </script>
  <script>

function returnStat(oId,pId){

    $.ajax({

      url:'/return-order',
      data:{
        oId:oId,
        pId:pId
      },
      method:'post',
      success:(response)=>{
         location.reload()
      }

    })

  }
</script>